<?php
  $details = $this -> model -> attributes['order_details'] != null ? json_decode($this -> model -> attributes['order_details']) : [];
  $i = 0;
?>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Producto</th>
        <th>CÃ³digo de marca</th>
        <th>Costo</th>
        <th>Cantidad</th>
        <th>Subtotal</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody class="products-container">
      <?php forEach($details as $detail){ ?>
        <tr id="<?= $detail -> brand_code ?>">

          <td>
            <?= $detail -> product_name ?>
            <input type="hidden" name="Orders[order_details][<?= $i ?>][product_name]" value="<?= $detail -> product_name ?>"/>
          </td>
          
          <td>
            <?= $detail -> brand_code ?>
            <input type="hidden" name="Orders[order_details][<?= $i ?>][brand_code]" value="<?= $detail -> brand_code ?>"/>
          </td>
          
          <td>
            <input
            readonly
            type="text"
            id="price-<?= $i ?>"
            class="form-control text-center"
            name="Orders[order_details][<?= $i ?>][brand_public_price]"
            value="<?= $detail -> brand_public_price ?>"
            required>
          </td>
    
          <td>
            <input
            onchange="updateTotalSubtotalOrder(<?= $i ?>)"
            type="number"
            step="1"
            name="Orders[order_details][<?= $i ?>][product_quantity]"
            min="1"
            id="quantity-<?= $i ?>"
            value="<?= $detail -> product_quantity ?>"
            class="form-control text-center"
            autocomplete="off"
            pattern="-?\d+(\.\d+)?"
            maxlength="255"
            required="true">
          </td>
    
          <td>
            <input
            readonly
            type="number"
            name=""
            id="subtotal-<?= $i ?>"
            value="<?= intval($detail -> brand_public_price) * intval($detail -> product_quantity) ?>"
            class="form-control text-center subtotal-items"
            required="true">
          </td>
          
          <td>
            <button type="button" class="btn btn-info btn-sm" onclick="getProductData('<?= $detail -> brand_code ?>')">
              <i class="icon icon-eye"></i>
            </button>
            <button onclick="detachOrderProductUnsaved('<?= $detail -> brand_code ?>')" type="button" class="btn btn-danger btn-sm">
              <i class="icon icon-times"></i>
            </button>
          </td>

        </tr>
      <?php $i++ ?>
      <?php } ?>
    </tbody>
  </table>

<?php include '_product-browser.htm' ?>

<div class="text-center" style="margin-top:10px;">
  <button type="button" onclick="toggleNewProduct(true)" id="add-product-quotation" class="btn btn-info">
    Agregar Producto
  </button>
</div>

<?php include '_popproduct.htm' ?>